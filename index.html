<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Harp Server</title>
    <link rel="stylesheet" href="style.css">
    <style>
    * { box-sizing: border-box; }
    html { background: #3E5E6B; }
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      font-family: "Open Sans", sans-serif;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    h1 {
      margin: 0 0 40px 0;
      color: #4F727F;
    }
    #splashscreen {
      background: #67919e;
      padding: 40px;
      width: 100%;
      height: 100%;
      display: flex;
	  align-items: center;
	  justify-content: center;
	  position:absolute;
	  bottom:0;
	  left:0;
	  transition:all 1s cubic-bezier(1.000, -0.530, 0.405, 1.425);
	  z-index: 200;
    }
    #splashscreen .container {
      display: table-cell;
      vertical-align: middle;
      text-align: center;
    }
    #splashscreen img { width: 100px; }
    #server-status {
		min-height:0%;
		transition:all 1s ease-in-out;//all 1s cubic-bezier(1.000, -0.530, 0.405, 1.425);
		overflow: hidden;
		text-align: center;
		width: 100%;
		padding-top: 20%;
    }
    #holder {
      width: 190px;
      height: 190px;
      margin: 0 auto;
      text-align: center;
      border-radius: 5px;
      -webkit-user-select: none;
      display: flex;
	  align-items: center;
	  justify-content: center;
      background: linear-gradient(90deg, #82a4ae 50%, transparent 50%), linear-gradient(90deg, #82a4ae 50%, transparent 50%), linear-gradient(0deg, #82a4ae 50%, transparent 50%), linear-gradient(0deg, #82a4ae 50%, transparent 50%);
      background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
	  background-size: 16px 4px, 16px 4px, 4px 16px, 4px 16px;
	  background-position: 0px 0px, 186px 186px, 0px 186px, 186px 0px;
	  animation: entopacity 2s 1;
    }
    #holder.hover {
        animation: border-dance 6s infinite linear;
    }
    .label {
      color: #3E575F;
      margin: 40px 0;
    }
    #holder img{
    	animation: entrance 1s 1;
    }
    body.server-on #server-status {
    	min-height: 100%;
      	overflow: hidden;
    }
    body.server-on #splashscreen {
      	height: 220px;
		animation: elasticborder 1s 1;
    }
    body.server-on #holder { padding: 20px; }
    body.server-on #splashscreen h1,
    body.server-on #splashscreen .label { display: none; }
    #app-path {
      color: #4F727F;
      font-size: 20px;
      padding: 20px;
    }
    #server-status .title {
      color: #67919E;
      text-transform: uppercase;
      font-size: 10px;
    }
    #server-url a {
      color: white;
      font-size: 24px;
      text-decoration: none;
      display: block;
      padding: 10px;
    }
    #server-url a:hover { color: white; }
    .controls { padding: 20px; }
    .controls a {
      background: #67919e;
      border-radius: 4px;
      margin: 20px;
    }
    .visual {
    	width: 100%;
		background-image: url(images/wave.svg);
		/* background-position: left center, right center; */
		background-size: 100% 100%;
		background-repeat: no-repeat;
		position:relative;
    }
    .folderopen {
    	width: 120px;
    	position: relative;
    	z-index: 101;
    }
    .bluline{
    	top: 0;
		left: 0;
		position: absolute;
		width: 5px;
		height: 100%;
		background: #3E5E6B;
		animation: dataanimation 5s infinite ease-in;
		z-index: 100;
    }
    .footerbar {
      position: absolute;
      bottom: 0;
      width: 100%;
      z-index: 300;
    }
    .left { float: left; }
    .right { float: right; }
    .footerbar {
      text-transform: uppercase;
      font-size: 11px;
      font-weight:bold;
      padding: 15px;
      color: #82a4ae;
    }
    .footerbar a {
      color: #4F727F;
      text-decoration: none;
      padding: 5px;
    }
    .footerbar a:hover{
      color: #3E575F;
    }
    @keyframes border-dance {
		0% {
			background-position: 0px 0px, 186px 186px, 0px 186px, 186px 0px;
		}
		100% {
			background-position: 186px 0px, 0px 186px, 0px 0px, 186px 186px;
		}
	}
	@keyframes entrance {
	  0% {
		height: 0px;
	  }
	  90% {
		height: 130px;
	  }
	  100% {
		height: 110px;
	  }
	}
	@keyframes entopacity{
		0% {
			opacity: 0;
	  	}
	  	100% {
			opacity: 1;
	  	}
	}
	@keyframes dataanimation{
		0% {
			left: 0;
	  	}
	  	100% {
			left: 100%;
	  	}
	}
	@keyframes elasticborder{
		0% {
			border-top-left-radius: 0% 0%;
    		border-top-right-radius: 0% 0%;
	  	}
	  	50% {
			border-top-left-radius: 50% 30%;
    		border-top-right-radius: 50% 30%;
	  	}
	  	100% {
			border-top-left-radius: 0% 0%;
    		border-top-right-radius: 0% 0%;
	  	}
	}
    </style>
  </head>
  <body>
    <script>
    document.onclick = function(e) {
      e.preventDefault();
      if (e.target.tagName == 'A')
        require('shell').openExternal(e.target.href);
      return false;
    };
    document.ondragover = document.ondrop = function(e) {
      e.preventDefault();
      return false;
    };
    </script>

    <div id="server-status">
    	<div class="data-status">
		  <div id="app-path"></div>
		  <div class="visual">
			<div class="bluline"></div>
			<img class="folderopen" src="images/open-folder.svg">
		  </div>
		  <div class="info">
			<div class="title">Your server is listening at</div>
			<div id="server-url"></div>
		  </div>
		   <!-- <div class="controls">
        <a id="launch">Launch</a>
        <a id="stop">Stop</a>
      </div> -->
		</div>
    </div>

    <div id="splashscreen">
      <div class="container">
        <h1>Server is not running</h1>
        <div id="holder">
          <img src="images/drag-folder.svg">
        </div>
        <div class="label">Drag a Harp app folder here to get started.</div>
      </div>
    </div>

    <footer class="footerbar">
      <div class="left"><a href="http://harpjs.com/faq">FAQ</a> | <a href="https://github.com/alexgleason/harp-gui">GitHub</a></div>
      <div class="right"><a href="http://harpjs.com/">About Harp</a></div>
    </footer>

    <script>
    var harp = require("harp");
    var path = require("path");
    var enableDestroy = require("server-destroy");
    var holder = document.getElementById('holder');
    var server = null;
    var port = 0;

    holder.ondragover = function () {
      this.className = 'hover';
      return false;
    };
    holder.ondragleave = holder.ondragend = function () {
      this.className = '';
      return false;
    };
    holder.ondrop = function (e) {
      this.className = '';
      e.preventDefault();
      var file = e.dataTransfer.files[0];
      var projectPath = path.resolve(process.cwd(), file.path || "");

      if (server !== null) server.destroy();
      harp.server(projectPath, { ip: '0.0.0.0', port: port }, function() {
        server = this;
        enableDestroy(this);
        port = this.address().port;
        var url = "http://localhost:" + port + "/";
        document.getElementById('app-path').innerHTML = projectPath;
        document.getElementById('server-url').innerHTML = '<a href="'+url+'">'+url+'</a>';
        document.body.className = 'server-on';
      });
      return false;
    };
    </script>
  </body>
</html>
